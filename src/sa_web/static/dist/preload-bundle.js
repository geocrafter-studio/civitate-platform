var Shareabouts=Shareabouts||{};!function(e){"use strict";e.Util={patch:function(e,t,n){var a,o={};for(a in t)o[a]=e[a],e[a]=t[a];n();for(a in o)e[a]=o[a]},setPrettyDateLang:function(e){moment.lang(e)},getPrettyDateTime:function(e,t){return t?moment(e).format(t):moment(e).fromNow()},getAttrs:function(e){var t={},n=[];return _.each(e.serializeArray(),function(e){_.isUndefined(t[e.name])?t[e.name]=e.value:(_.contains(n,e.name)||(n.push(e.name),t[e.name]=[t[e.name]]),t[e.name].push(e.value))}),t},findPageConfig:function(e,t){var n=_.findWhere(e,t);if(n)return n;for(var a=0;a<e.length;++a)if(e[a].pages&&(n=this.findPageConfig(e[a].pages,t)))return n},isSupported:function(e){switch(e.browser.name){case"Microsoft Internet Explorer":var t=e.browser.version.indexOf("."),n=parseInt(e.browser.version.substr(0,t),10);if(n>7)return!0;default:return!0}return!1},getPageLayout:function(){return window.getComputedStyle?window.getComputedStyle(document.body,":after").getPropertyValue("content"):"desktop"},setStickyFields:function(t,n,a){var o=_.pluck(_.filter(n,function(e){return e.sticky}),"name"),r=_.pluck(_.filter(a,function(e){return e.sticky}),"name"),i=_.union(o,r);e.stickyFieldValues||(e.stickyFieldValues={}),_.each(i,function(n){n in t&&(e.stickyFieldValues[n]=t[n])})},log:function(){var t=Array.prototype.slice.call(arguments,0);window.ga?this.analytics(t):e.Util.console.log(t)},analytics:function(e){var t,n,a=e.shift(),o={"center-lat":"metric1","center-lng":"metric2",zoom:"metric3","panel-state":"dimension1","language-code":"dimension2"};switch(a.toLowerCase()){case"route":e=["send","pageview"].concat(e);break;case"user":e=["send","event"].concat(e);break;case"app":if(t=e.shift(),n=o[t],!n)return void this.console.error('No metrics or dimensions matching "'+t+'"');e=["set",n].concat(e);break;default:return}window.ga.apply(window,e)},console:window.console||{log:function(){},debug:function(){},info:function(){},warn:function(){},error:function(){}},fileInputSupported:function(){var e=document.createElement("input");if(e.setAttribute("type","file"),e.disabled)return!1;var t;return window.FileReader?(t=new FileReader,t.readAsArrayBuffer?!0:!1):!1},fixImageOrientation:function(e,t){var n=document.createElement("canvas"),a=n.getContext("2d"),o=e.width,r=e.height;switch(t){case 5:case 6:case 7:case 8:n.width=e.height,n.height=e.width;break;default:n.width=e.width,n.height=e.height}switch(t){case 1:break;case 2:a.translate(o,0),a.scale(-1,1);break;case 3:a.translate(o,r),a.rotate(Math.PI);break;case 4:a.translate(0,r),a.scale(1,-1);break;case 5:a.rotate(.5*Math.PI),a.scale(1,-1);break;case 6:a.rotate(.5*Math.PI),a.translate(0,-r);break;case 7:a.rotate(.5*Math.PI),a.translate(o,-r),a.scale(-1,1);break;case 8:a.rotate(-.5*Math.PI),a.translate(-o,0)}return a.drawImage(e,0,0),n},fileToCanvas:function(t,n,a){var o=new FileReader;o.onloadend=function(){var o=EXIF.readFromBinaryFile(new BinaryFile(this.result)),r=o.Orientation;loadImage(t,function(t){var a=e.Util.fixImageOrientation(t,r);n(a)},a)},o.readAsArrayBuffer(t)},wrapHandler:function(e,t,n){var a=function(a){t.trigger(e,a),n&&n.apply(this,arguments)};return a},callWithRetries:function(e,t,n){var a=Array.prototype.slice.call(arguments,3),o=_.last(a),r=o.error,i=0;o||(o={},a.push(o)),o.error=function(){t>i?(i++,setTimeout(function(){e.apply(n,a)},100*i)):r&&r.apply(n,arguments)},e.apply(n,a)},cookies:{save:function(e,t,n){var a;if(n){var o=new Date;o.setTime(o.getTime()+24*n*60*60*1e3),a="; expires="+o.toGMTString()}else a="";document.cookie=e+"="+t+a+"; path=/"},get:function(e){for(var t=e+"=",n=document.cookie.split(";"),a=0;a<n.length;a++){for(var o=n[a];" "===o.charAt(0);)o=o.substring(1,o.length);if(0===o.indexOf(t))return o.substring(t.length,o.length)}return null},destroy:function(e){this.save(e,"",-1)}},MapQuest:{geocode:function(t,n,a){var o=e.bootstrapped.mapQuestKey;if(!o)throw"You must provide a MapQuest key for geocoding to work.";a=a||{},a.dataType="jsonp",a.cache=!0,a.url="https://open.mapquestapi.com/geocoding/v1/address?key="+o+"&location="+t,n&&(a.url+="&boundingBox="+n.join(",")),$.ajax(a)},reverseGeocode:function(t,n){var a,o,r=e.bootstrapped.mapQuestKey;if(!r)throw"You must provide a MapQuest key for geocoding to work.";a=t.lat||t[0],o=t.lng||t[1],n=n||{},n.dataType="jsonp",n.cache=!0,n.url="https://open.mapquestapi.com/geocoding/v1/reverse?key="+r+"&location="+a+","+o,$.ajax(n)}},Mapbox:{toMapQuestResult:function(e){return e.latLng={lat:e.center[1],lng:e.center[0]},e.center&&delete e.center,e.relevance&&delete e.relevance,e.address&&delete e.address,e.context&&delete e.context,e.bbox&&delete e.bbox,e.id&&delete e.id,e.text&&delete e.text,e.type&&delete e.type,e},toMapQuestResults:function(e){return e.results=e.features,e.results.length>0&&(e.results[0]={locations:[Shareabouts.Util.Mapbox.toMapQuestResult(e.results[0])],providedLocation:{location:e.query.join(" ")}}),e},geocode:function(t,n,a){var o=e.bootstrapped.mapboxToken,r=a&&a.success,i=function(e){r&&r(Shareabouts.Util.Mapbox.toMapQuestResults(e))};if(!o)throw"You must provide a Mapbox access token (Shareabouts.bootstrapped.mapboxToken) for geocoding to work.";a=a||{},a.dataType="json",a.cache=!0,a.url="https://api.mapbox.com/geocoding/v5/mapbox.places/"+encodeURIComponent(t)+".json?access_token="+o,n&&(a.url+="&proximity="+n.join(",")),a.success=i,$.ajax(a)},reverseGeocode:function(t,n){var a,o,r=e.bootstrapped.mapboxToken;if(!r)throw"You must provide a Mapbox access token (Shareabouts.bootstrapped.mapboxToken) for geocoding to work.";a=t.lat||t[0],o=t.lng||t[1],n=n||{},n.dataType="json",n.cache=!0,n.url="https://api.mapbox.com/geocoding/v5/mapbox.places/"+o+","+a+".json?access_token="+r,$.ajax(n)}}}}(Shareabouts);var Shareabouts=Shareabouts||{};!function(e){e.TemplateHelpers={insertInputTypeFlags:function(t){_.each(t,function(t){t.is_input=!t.type||["textarea","select","file","geocoding","checkbox-list","hidden"].indexOf(t.type)<0,t.is_textarea="textarea"===t.type,t.is_select="select"===t.type,t.is_checkbox_list="checkbox-list"===t.type,t.is_file="file"===t.type,t.is_geocoding="geocoding"===t.type,t.is_hidden="hidden"===t.type,t.is_fileinput_supported=e.Util.fileInputSupported()})},getItemsFromModel:function(e,t,n){var a=_.filter(e,function(e){return-1===_.indexOf(n,e.name)}),o=[];return _.each(a,function(e){o.push({name:e.name,label:e.label,value:t.get(e.name)})}),o},overridePlaceTypeConfig:function(e,t){var n,a=_.find(e,function(e){return"location_type"===e.name});a&&"select"===a.type&&(t||_.isArray(a.options)&&1===a.options.length)&&(a.type="hidden",a.prompt=null,n=t?{key:"value",value:t}:{key:"value",value:a.options[0]},delete a.options,_.isArray(a.attrs)&&a.attrs.length>0?_.each(a.attrs,function(e,t){"value"===e.key&&(a.attrs[t]=n)}):a.attrs=[n])},formatNumber:function(e){var t,n,a=0,o=e,r=3,i=o,s=""+i,c="";for(-1==s.indexOf(".")&&(s+="."),n=s.substr(0,s.indexOf(".")),t=s.substr(s.indexOf("."));t.length-1<a;)t+="0";if("."==t&&(t=""),n.length>r){for(;n.length>r;)c=","+n.substr(n.length-r)+c,n=n.substr(0,n.length-r);c=n+c}else c=n;return c+=t}}}(Shareabouts);